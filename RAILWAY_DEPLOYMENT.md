# Railway Deployment Guide for Synthetica

This guide will walk you through deploying Synthetica to Railway with PostgreSQL.

## Prerequisites

- Railway account (sign up at https://railway.app/)
- GitHub account
- Your Anthropic API key
- Your Stripe API keys (Secret Key and Webhook Secret)

## Step 1: Push Code to GitHub

```bash
cd /Users/arsenispapachristos/synthetica

# Initialize git if not already done
git init

# Add all files
git add .

# Commit
git commit -m "Initial commit for Railway deployment"

# Create a new repository on GitHub, then:
git remote add origin https://github.com/YOUR_USERNAME/synthetica.git
git branch -M main
git push -u origin main
```

## Step 2: Create New Railway Project

1. Go to https://railway.app/new
2. Click "Deploy from GitHub repo"
3. Select your `synthetica` repository
4. Railway will automatically detect it's a Python project

## Step 3: Add PostgreSQL Database

1. In your Railway project dashboard, click "+ New"
2. Select "Database" → "Add PostgreSQL"
3. Railway will automatically create a PostgreSQL database
4. The `DATABASE_URL` environment variable will be automatically added to your service

## Step 4: Configure Environment Variables

In your Railway project, go to your web service → "Variables" tab and add:

```env
ANTHROPIC_API_KEY=your_anthropic_api_key_here
STRIPE_SECRET_KEY=your_stripe_secret_key_here
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here
PORT=8000
```

**Important:** The `DATABASE_URL` variable should already be there from step 3.

## Step 5: Deploy

Railway will automatically deploy your application. You can monitor the deployment in the "Deployments" tab.

The deployment process:
1. Installs Python dependencies from `requirements.txt`
2. Runs database migrations (automatic via your `_init_database()` method)
3. Starts the web server using the `Procfile`

## Step 6: Set Up Custom Domain (Optional)

1. Go to "Settings" → "Networking"
2. Click "Generate Domain" for a free Railway domain
3. Or add your custom domain

## Step 7: Configure Stripe Webhook

Once deployed:

1. Get your Railway URL (e.g., `https://your-app.up.railway.app`)
2. Go to Stripe Dashboard → Developers → Webhooks
3. Click "Add endpoint"
4. Enter: `https://your-app.up.railway.app/api/webhooks/stripe`
5. Select events: `checkout.session.completed`
6. Copy the webhook secret and update it in Railway environment variables

## Step 8: Test Your Deployment

Visit your Railway URL:
- `https://your-app.up.railway.app/` - Landing page
- `https://your-app.up.railway.app/generate` - Generator interface
- `https://your-app.up.railway.app/docs` - API documentation
- `https://your-app.up.railway.app/health` - Health check

## Verification Checklist

- [ ] Database connection working (check logs)
- [ ] Homepage loads correctly
- [ ] Can create a new user account
- [ ] Can generate conversations
- [ ] Stripe checkout flow works
- [ ] Webhooks are receiving events

## Monitoring and Logs

- View logs: Railway dashboard → "Deployments" → Click on a deployment
- Monitor metrics: Railway dashboard → "Metrics" tab
- Database: Railway dashboard → PostgreSQL service → "Data" tab

## Updating Your Deployment

Every time you push to your GitHub repository:

```bash
git add .
git commit -m "Your update message"
git push origin main
```

Railway will automatically redeploy your application.

## Environment Variables Reference

| Variable | Required | Description |
|----------|----------|-------------|
| `DATABASE_URL` | Yes | Auto-generated by Railway PostgreSQL |
| `ANTHROPIC_API_KEY` | Yes | Your Anthropic API key for Claude |
| `STRIPE_SECRET_KEY` | Yes | Your Stripe secret API key |
| `STRIPE_WEBHOOK_SECRET` | Yes | Your Stripe webhook signing secret |
| `PORT` | No | Port to run on (Railway sets this automatically) |

## Troubleshooting

### Database Connection Issues
- Ensure `DATABASE_URL` is set in environment variables
- Check logs for connection errors
- Verify PostgreSQL service is running

### Application Won't Start
- Check deployment logs for errors
- Verify all required dependencies are in `requirements.txt`
- Ensure `Procfile` is correctly configured

### Stripe Webhooks Not Working
- Verify webhook URL is correct
- Check webhook secret matches
- Ensure endpoint is publicly accessible
- Review webhook logs in Stripe dashboard

## Cost Estimation

Railway Pricing (as of 2024):
- **Hobby Plan**: $5/month (includes $5 usage credit)
- **PostgreSQL**: ~$2-5/month depending on usage
- **Estimated Total**: ~$5-10/month for low-moderate traffic

## Local Development vs Production

The application automatically detects the environment:
- **Local**: Uses SQLite database
- **Railway**: Uses PostgreSQL (when `DATABASE_URL` is set)

No code changes needed between environments!

## Security Best Practices

1. ✅ Never commit API keys to git
2. ✅ Use environment variables for all secrets
3. ✅ Enable Stripe webhook signature verification
4. ✅ Use HTTPS in production (Railway provides this automatically)
5. ✅ Regularly rotate API keys
6. ✅ Monitor usage and logs for suspicious activity

## Support

If you encounter issues:
1. Check Railway documentation: https://docs.railway.app/
2. Review application logs in Railway dashboard
3. Check GitHub Issues for common problems

## Additional Resources

- Railway Docs: https://docs.railway.app/
- FastAPI Deployment: https://fastapi.tiangolo.com/deployment/
- PostgreSQL Best Practices: https://www.postgresql.org/docs/

---

**Deployment Date**: $(date)
**Version**: 2.0.0
**Status**: Production Ready ✅
